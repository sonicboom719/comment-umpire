# コメント分析機能テスト

このディレクトリには、Comment Umpireのコメント分析機能をテストするためのテストコードが含まれています。

## テストファイル

### `test_comment_analysis.py`
メインのテストファイルです。以下の機能をテストします：

1. **ポジティブコメントの分類テスト**
   - 賞賛、感謝、情報提供などの分類が正しく行われるかテスト

2. **ネガティブコメントの分類テスト**
   - 批判、誹謗中傷、嘲笑、上から目線などの分類が正しく行われるかテスト

3. **グラハムのヒエラルキーの判定テスト**
   - Lv1（罵倒）からLv7（主眼論破）までの反論レベルが正しく判定されるかテスト

4. **論理的誤謬の判定テスト**
   - 対人論証、権威論証、お前だって論法などの誤謬が正しく検出されるかテスト

5. **情報提供・問題提起コメントのテスト**
   - 建設的なコメントが適切に分類されるかテスト

6. **文脈分析のテスト**
   - 親コメントと返信の文脈を考慮した分析が正しく行われるかテスト

### `run_tests.py`
テスト実行用のシンプルなランナーです。

## テストの実行方法

### 1. 依存関係のインストール
```bash
pip install pytest
```

### 2. 環境変数の設定
`.env`ファイルに以下を設定してください：
```
OPENAI_API_KEY=your_openai_api_key
YOUTUBE_API_KEY=your_youtube_api_key
```

### 3. テストの実行

#### 方法1: run_tests.pyを使用
```bash
python run_tests.py
```

#### 方法2: 直接テストファイルを実行
```bash
python test_comment_analysis.py
```

#### 方法3: pytestを使用（推奨）
```bash
pytest test_comment_analysis.py -v
```

## テストケース例

### ポジティブコメント
- `"すごく面白い動画でした！"` → `["感想", "賞賛"]`
- `"ありがとうございます！勉強になりました"` → `["感謝"]`

### ネガティブコメント
- `"つまらない動画だな"` → `["批判"]`
- `"この人いつも間違ってるよね"` → `["誹謗中傷", "侮辱"]`

### グラハムのヒエラルキー
- `"馬鹿じゃないの"` → `Lv1: 罵倒`
- `"あなたみたいな素人には分からないでしょう"` → `Lv2: 人格攻撃`
- `"その説明は間違っています。正しくは○○です"` → `Lv5: 反論提示`

### 論理的誤謬
- `"あの人が言うことなんて信用できない"` → `対人論証`
- `"専門家も言ってるから間違いない"` → `権威論証`

## テスト実行時の注意事項

1. **APIキーが設定されていない場合**
   - テストはモック（偽の応答）を使用して実行されます
   - 実際のAI分析は行われませんが、関数の動作確認は可能です

2. **実際のAPI分析テストを行う場合**
   - OPENAI_API_KEYを設定してください
   - API使用料金が発生する可能性があります

3. **テスト結果の確認**
   - 各テストケースの結果が表示されます
   - `✓` マークは成功、`✗` マークは失敗を示します

## テストの拡張

新しいテストケースを追加する場合は、`test_comment_analysis.py`の該当するメソッドに以下の形式で追加してください：

```python
{
    "comment": "テスト用のコメント",
    "expected_category": ["期待されるカテゴリ"],
    "expected_counter": True/False,
    "expected_hierarchy": "期待されるヒエラルキー",
    "description": "テストの説明"
}
```

## トラブルシューティング

### よくある問題

1. **ModuleNotFoundError**: 
   - `streamlit_app.py`と同じディレクトリでテストを実行してください

2. **API Key Error**:
   - `.env`ファイルが正しく設定されているか確認してください

3. **Import Error**:
   - 必要な依存関係がインストールされているか確認してください

### デバッグモード

より詳細なログが必要な場合は、テストファイル内の`print`文のコメントアウトを解除してください。